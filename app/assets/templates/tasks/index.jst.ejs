<h2><%= project.escape('name')%></h2>
<button class="sort btn btn-info">
  Sort by <%= sortByDate ? "priority" : "due date" %>
</button><br><br>
<div id="sortable">  
<% tasks.each(function(task){ %>
<% if (task.get('parent_id')) { return } %>
<% var completeClass = task.get('completed') ? 'completed-task' : 'incomplete-task' %>
<% var checkedTask = task.get('completed') ? 'checked' : '' %>
<% var labelTask = task.get('completed') ? 'label-success' : 'label-important' %>
<div class="row tasks" data-id= "<%= task.id %>">
  <div class="span8 offset1">
    <input type='checkbox' <%= checkedTask %> 
           class="complete-check" data-id="<%= task.id %>">
    <span class="task_list <%= completeClass %>" data-id="<%= task.id %>">
       <%= task.escape('name') %>
    </span>
  </div>
  <div class="span2 offset1">

    <%if (task.get('due')){ %>
    <span class="due-date label <%= labelTask %>">
      <%= (new Date(task.get('due')).toLocaleDateString()) %> 
    </span><br>
    <% }%>
  </div>
</div>
<% }) %>
</div>
<br>
<input placeholder="Task..." type="text" id="form-task" class="form-control">

<script>
$(function(){
  $('#sortable').sortable({
    update: function(event, ui){
      $('.tasks', this).each(function(i){
        var task_id = $(this).data('id');
        var task = Breath.user.tasks().get(task_id);
        task.save('order', i, {silent: true});
        if (task.get('project_id') !== 0 && task.get('project_id')) {
          var project = Breath.user.projects().get(task.get('project_id'));
          project.tasks().get(task_id).set('order', i, {silent: true});
        }
      });
      Breath.user.tasks().sort();
    }
  });
});
</script>
